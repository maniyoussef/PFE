<div class="container">
  <h2>Client Assignments Debugger</h2>
  <p>Use this tool to diagnose issues with client project and category assignments.</p>

  <div class="loading" *ngIf="clientsLoading">
    <mat-spinner diameter="40"></mat-spinner>
    <span>Loading clients...</span>
  </div>

  <div class="error-message" *ngIf="clientsError">
    <mat-error>{{ clientsError }}</mat-error>
  </div>

  <mat-card class="debug-card">
    <mat-card-header>
      <mat-card-title>Select a Client to Debug</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-form-field appearance="fill" style="width: 100%;">
        <mat-label>Select Client</mat-label>
        <mat-select [formControl]="debugClientControl">
          <mat-option [value]="null">-- Select a client --</mat-option>
          <mat-option *ngFor="let client of clients" [value]="client.id">
            {{ client.name }} (ID: {{ client.id }})
          </mat-option>
        </mat-select>
      </mat-form-field>
    </mat-card-content>
  </mat-card>

  <div *ngIf="projectResults.clientId > 0" class="results-container">
    <mat-card class="debug-card">
      <mat-card-header>
        <mat-card-title>Projects for Client ID: {{ projectResults.clientId }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="endpoint-info">
          <strong>Endpoint:</strong> {{ projectResults.url }}
          <button mat-stroked-button color="accent" (click)="testDirectHttpRequest(projectResults.url, 'project')">
            Test Direct HTTP Request
          </button>
        </div>

        <div class="loading" *ngIf="projectResults.loading">
          <mat-spinner diameter="30"></mat-spinner>
          <span>Loading projects...</span>
        </div>

        <div class="error-message" *ngIf="projectResults.error">
          <mat-error>{{ projectResults.error }}</mat-error>
        </div>

        <div *ngIf="!projectResults.loading && projectResults.projects.length === 0 && !projectResults.error">
          <p>No projects found for this client.</p>
        </div>

        <div *ngIf="projectResults.projects.length > 0" class="results-table">
          <h3>Projects ({{ projectResults.projects.length }})</h3>
          <table mat-table [dataSource]="projectResults.projects" class="mat-elevation-z2">
            <ng-container matColumnDef="id">
              <th mat-header-cell *matHeaderCellDef>ID</th>
              <td mat-cell *matCellDef="let project">{{ project.id }}</td>
            </ng-container>

            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Name</th>
              <td mat-cell *matCellDef="let project">{{ project.name }}</td>
            </ng-container>

            <ng-container matColumnDef="description">
              <th mat-header-cell *matHeaderCellDef>Description</th>
              <td mat-cell *matCellDef="let project">{{ project.description }}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="['id', 'name', 'description']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['id', 'name', 'description']"></tr>
          </table>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="debug-card">
      <mat-card-header>
        <mat-card-title>Categories for Client ID: {{ categoryResults.clientId }}</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="endpoint-info">
          <strong>Endpoint:</strong> {{ categoryResults.url }}
          <button mat-stroked-button color="accent" (click)="testDirectHttpRequest(categoryResults.url, 'category')">
            Test Direct HTTP Request
          </button>
        </div>

        <div class="loading" *ngIf="categoryResults.loading">
          <mat-spinner diameter="30"></mat-spinner>
          <span>Loading categories...</span>
        </div>

        <div class="error-message" *ngIf="categoryResults.error">
          <mat-error>{{ categoryResults.error }}</mat-error>
        </div>

        <div *ngIf="!categoryResults.loading && categoryResults.categories.length === 0 && !categoryResults.error">
          <p>No categories found for this client.</p>
        </div>

        <div *ngIf="categoryResults.categories.length > 0" class="results-table">
          <h3>Categories ({{ categoryResults.categories.length }})</h3>
          <table mat-table [dataSource]="categoryResults.categories" class="mat-elevation-z2">
            <ng-container matColumnDef="id">
              <th mat-header-cell *matHeaderCellDef>ID</th>
              <td mat-cell *matCellDef="let category">{{ category.id }}</td>
            </ng-container>

            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Name</th>
              <td mat-cell *matCellDef="let category">{{ category.name }}</td>
            </ng-container>

            <ng-container matColumnDef="description">
              <th mat-header-cell *matHeaderCellDef>Description</th>
              <td mat-cell *matCellDef="let category">{{ category.description }}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="['id', 'name', 'description']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['id', 'name', 'description']"></tr>
          </table>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>

<style>
  .container {
    margin: 20px;
  }
  
  .debug-card {
    margin-bottom: 20px;
  }
  
  .loading {
    display: flex;
    align-items: center;
    margin: 20px 0;
  }
  
  .loading span {
    margin-left: 10px;
  }
  
  .error-message {
    margin: 10px 0;
    padding: 10px;
    background-color: rgba(255, 0, 0, 0.1);
    border-radius: 4px;
  }
  
  .results-container {
    margin-top: 20px;
  }
  
  .results-table {
    margin-top: 20px;
  }
  
  .endpoint-info {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 15px;
    padding: 10px;
    background-color: #f5f5f5;
    border-radius: 4px;
  }
</style> 